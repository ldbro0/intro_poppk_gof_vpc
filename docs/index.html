<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.550">

  <meta name="author" content="Logan Brooks">
  <meta name="dcterms.date" content="2024-10-23">
  <title>Goodness-of-Fit and Visual Predictive Checks in PopPK Modeling</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="images/custom.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
  <script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
  <link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
  <script src="site_libs/datatables-binding-0.33/datatables.js"></script>
  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
  <link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
  <script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
  <link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
  <script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Goodness-of-Fit and Visual Predictive Checks in PopPK Modeling</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Logan Brooks 
</div>
</div>
</div>

  <p class="date">2024-10-23</p>
</section>
<section>
<section id="introduction-to-goodness-of-fit-in-population-pk-modeling" class="title-slide slide level1 center">
<h1>Introduction to Goodness-of-Fit in Population PK Modeling</h1>

</section>
<section id="definition-and-importance" class="slide level2">
<h2>1.1 Definition and Importance</h2>
<p><strong>Goodness-of-Fit (GOF)</strong> measures the agreement between a model and the observed data in population PK modeling. It’s crucial for validating model performance and assumptions.</p>
<ul>
<li><strong>Key Focus:</strong> Model evaluation (diagnostics, adequacy, assessment) vs.&nbsp;model-building and qualification.</li>
<li><strong>Why It Matters:</strong> Visual assessment plays a critical role in evaluating nonlinear mixed-effect models (NLMEMs).</li>
</ul>
</section>
<section id="objectives-of-gof-assessment" class="slide level2">
<h2>1.2 Objectives of GOF Assessment</h2>
<ul>
<li>Ensure that the model adequately describes observed data.</li>
<li>Assess whether model assumptions (e.g., distribution, variability) are met.</li>
<li>Identify possible areas for improvement by detecting systematic discrepancies.</li>
</ul>
<p><strong>Graphical methods</strong> provide insight into: - Structural model correctness - Residual and random variability assessments.</p>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="goodness-of-fit-diagnostic-plots" class="title-slide slide level1 center">
<h1>Goodness-of-Fit Diagnostic Plots</h1>

</section>
<section id="observed-vs.-predicted-plots" class="slide level2 scrollable smaller">
<h2>2.1 Observed vs.&nbsp;Predicted Plots</h2>
<h3 id="population-predictions-pred-vs.-observations-dv">Population Predictions (PRED) vs.&nbsp;Observations (DV)</h3>
<ul>
<li>Interpretation: Ideally, data should scatter uniformly around the line of identity. Systematic deviations could indicate structural model misspecifications​
<ul>
<li>The addition of informative covariates <em>should</em> reduce the scatter of the data points around the line of identity</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="co"># Generate PRED vs. DV plots</span></span>
<span id="cb1-2"><a></a>plot_pred_misspecified <span class="ot">&lt;-</span> pmplots<span class="sc">::</span><span class="fu">dv_pred</span>(misspecified_fit) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Misspecified Model"</span>)</span>
<span id="cb1-3"><a></a>plot_pred_true <span class="ot">&lt;-</span> pmplots<span class="sc">::</span><span class="fu">dv_pred</span>(true_fit) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"True Model"</span>)</span>
<span id="cb1-4"><a></a></span>
<span id="cb1-5"><a></a><span class="co"># Display plots side by side</span></span>
<span id="cb1-6"><a></a>plot_pred_misspecified <span class="sc">+</span> plot_pred_true</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-4-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<h3 id="individual-predictions-ipred-vs.-observations-dv">Individual Predictions (IPRED) vs.&nbsp;Observations (DV)</h3>
<ul>
<li><p>Interpretation: Ideally, data should scatter uniformly around the line of identity. Systematic deviations could indicate structural model misspecifications​</p>
<ul>
<li>Need to be careful in situations with high shrinkage, as individual predictions may be biased​</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="co"># Generate IPRED vs. DV plots</span></span>
<span id="cb2-2"><a></a>plot_ipred_misspecified <span class="ot">&lt;-</span> pmplots<span class="sc">::</span><span class="fu">dv_ipred</span>(misspecified_fit) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Misspecified Model"</span>)</span>
<span id="cb2-3"><a></a>plot_ipred_true <span class="ot">&lt;-</span> pmplots<span class="sc">::</span><span class="fu">dv_ipred</span>(true_fit) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"True Model"</span>)</span>
<span id="cb2-4"><a></a></span>
<span id="cb2-5"><a></a><span class="co"># Display plots side by side</span></span>
<span id="cb2-6"><a></a>plot_ipred_misspecified <span class="sc">+</span> plot_ipred_true</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-5-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="residual-plots" class="slide level2 scrollable smaller">
<h2>2.2 Residual Plots</h2>
<ul>
<li>There are several flavors of residuals that are commonly used in popPK modeling
<ul>
<li>Notably Conditional Weighted Residuals (CWRES) and Individual Weighted Residuals (IWRES)</li>
</ul></li>
</ul>
<p><strong>Conditional Weighted Residuals (CWRES)</strong> - CWRES are calculated based on the conditional distribution of observations, taking into account both inter-individual and intra-individual variability. They are computed as:</p>
<p><span class="math inline">\(\text{CWRES}_i = \frac{y_i - \hat{y}_{i,\text{cond}}}{\text{Var}(y_i \mid \hat{\theta}, \hat{\eta}_i)}\)</span></p>
<p>Where:</p>
<ul>
<li>( <span class="math inline">\(y_i\)</span> ) is the observed data point for individual ( i ),</li>
<li>( <span class="math inline">\(\hat{y}_{i,\text{cond}}\)</span> ) is the conditional prediction given the individual’s parameters ( <span class="math inline">\(\hat{\theta}\)</span> ) and ( <span class="math inline">\(\hat{\eta}_i\)</span> ) (i.e., the individual-specific prediction),</li>
<li>( <span class="math inline">\(\text{Var}(y_i \mid \hat{\theta} \hat{\eta}_i)\)</span> ) is the conditional variance of ( <span class="math inline">\(y_i\)</span> ), accounting for both the inter-individual variability (from random effects, ( <span class="math inline">\(\eta\)</span> )) and intra-individual variability (residual error, ( <span class="math inline">\(\epsilon\)</span> )).</li>
</ul>
<p>Thus, CWRES adjusts for the uncertainty in the model predictions and are normalized by the conditional variance.</p>
<p><strong>Individual Weighted Residuals (IWRES)</strong></p>
<p>IWRES are simpler and involve the difference between the observed data and the individual predictions, scaled by the model’s prediction error for the individual. Mathematically, they are expressed as:</p>
<p><span class="math inline">\(\ \text{IWRES}_i = \frac{y_i - \hat{y}_{i,\text{ind}}}{\sigma}\)</span></p>
<p>Where:</p>
<ul>
<li>( <span class="math inline">\(y_i\)</span> ) is the observed data point for individual ( i ),</li>
<li>( <span class="math inline">\(\hat{y}_{i,\text{ind}}\)</span> ) is the individual prediction (IPRED), which depends only on the individual parameters ( <span class="math inline">\(\hat{\theta}\)</span> ) and ( <span class="math inline">\(\hat{\eta}_i\)</span> ),</li>
<li>( <span class="math inline">\(\sigma\)</span> ) is the residual unexplained variability (standard deviation of the residual error).</li>
</ul>
<p>IWRES do not account for the uncertainty in the model’s population parameters, unlike CWRES. They simply measure the discrepancy between the data and the individual prediction, scaled by the residual error.</p>
<p><strong>Summary of Differences</strong></p>
<ul>
<li><strong>CWRES</strong> accounts for the full variability of the data, including inter-individual and intra-individual variability, making it more reflective of the model’s conditional predictions.</li>
<li><strong>IWRES</strong> is based solely on individual predictions and residual error, making it a simpler, more localized residual that doesn’t account for population-level uncertainty.</li>
<li>CWRES generally provides a more comprehensive diagnostic when assessing how well the model fits the data, considering both individual and population variability, while IWRES focuses on individual-level fit.</li>
</ul>
</section>
<section class="slide level2">

<h3 id="cwres-vs.-time">CWRES vs.&nbsp;Time</h3>
<div class="cell">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="co"># Generate CWRES vs. Time plots</span></span>
<span id="cb3-2"><a></a>plot_cwres_time_misspecified <span class="ot">&lt;-</span> pmplots<span class="sc">::</span><span class="fu">cwres_time</span>(misspecified_fit) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Misspecified Model"</span>)</span>
<span id="cb3-3"><a></a>plot_cwres_time_true <span class="ot">&lt;-</span> pmplots<span class="sc">::</span><span class="fu">cwres_time</span>(true_fit) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"True Model"</span>)</span>
<span id="cb3-4"><a></a></span>
<span id="cb3-5"><a></a><span class="co"># Display plots side by side</span></span>
<span id="cb3-6"><a></a>plot_cwres_time_misspecified <span class="sc">+</span> plot_cwres_time_true</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-6-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<h3 id="cwres-vs.-predictions">CWRES vs.&nbsp;Predictions</h3>
<div class="cell">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a><span class="co"># Generate CWRES vs. Predictions plots</span></span>
<span id="cb4-2"><a></a>plot_cwres_pred_misspecified <span class="ot">&lt;-</span> pmplots<span class="sc">::</span><span class="fu">cwres_pred</span>(misspecified_fit) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Misspecified Model"</span>)</span>
<span id="cb4-3"><a></a>plot_cwres_pred_true <span class="ot">&lt;-</span> pmplots<span class="sc">::</span><span class="fu">cwres_pred</span>(true_fit) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"True Model"</span>)</span>
<span id="cb4-4"><a></a></span>
<span id="cb4-5"><a></a><span class="co"># Display plots side by side</span></span>
<span id="cb4-6"><a></a>plot_cwres_pred_misspecified <span class="sc">+</span> plot_cwres_pred_true</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-7-1.png" width="960" class="r-stretch"></section>
<section id="quantile-quantile-q-q-plots" class="slide level2 smaller">
<h2>2.3 Quantile-Quantile (Q-Q) Plots</h2>
<ul>
<li>Assessing normality of residuals helps in verifying distributional assumptions. Deviations suggest model misspecification​</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="co"># Q-Q Plot of CWRES misspecified model vs true model</span></span>
<span id="cb5-2"><a></a>plot_qq_misspecified <span class="ot">&lt;-</span> pmplots<span class="sc">::</span><span class="fu">cwres_q</span>(misspecified_fit) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Misspecified Model"</span>)</span>
<span id="cb5-3"><a></a>plot_qq_true <span class="ot">&lt;-</span> pmplots<span class="sc">::</span><span class="fu">cwres_q</span>(true_fit) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"True Model"</span>)</span>
<span id="cb5-4"><a></a></span>
<span id="cb5-5"><a></a><span class="co"># Display plots side by side</span></span>
<span id="cb5-6"><a></a>plot_qq_misspecified <span class="sc">+</span> plot_qq_true</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-8-1.png" width="960" class="r-stretch"></section>
<section id="other-diagnostic-plots-eta-distribution" class="slide level2 smaller">
<h2>2.4 Other Diagnostic Plots: Eta Distribution</h2>
<ul>
<li>Eta Shrinkage and Empirical Bayes Estimates (EBE) Correlations High Shrinkage (&gt; 30%) may distort individual parameter estimates and random effect assumptions.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a><span class="co"># Plot Eta Histograms and EBE correlations</span></span>
<span id="cb6-2"><a></a>p <span class="ot">&lt;-</span> true_fit <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a></a>  <span class="fu">select</span>(ID,eta.Km, eta.CL, eta.V1) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a></a>  pmplots<span class="sc">::</span><span class="fu">eta_hist</span>(, <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"eta.Km"</span>,<span class="st">"eta.CL"</span>, <span class="st">"eta.V1"</span>))</span>
<span id="cb6-6"><a></a></span>
<span id="cb6-7"><a></a>p[[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>),<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">'dashed'</span>) <span class="sc">+</span> </span>
<span id="cb6-8"><a></a>p[[<span class="dv">2</span>]] <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">'dashed'</span>) <span class="sc">+</span> </span>
<span id="cb6-9"><a></a>p[[<span class="dv">3</span>]] <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">'dashed'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-9-1.png" width="960" class="r-stretch"></section>
<section id="other-diagnostic-plots-shrinkage" class="slide level2 scrollable smaller">
<h2>2.5 Other Diagnostic Plots: Shrinkage</h2>
<ul>
<li>Eta Shrinkage and Empirical Bayes Estimates (EBE)
<ul>
<li>High Shrinkage (&gt; 30%) may distort individual parameter estimates and random effect assumptions.</li>
<li>“In an extreme case of no data available on a particular individual, the individual’s EBE will be equal to the population value. So, the variance of EBE distribution is shrinking towards zero as the quantity of information at the individual level diminishes, a phenomenon defined as η-shrinkage.” (Savic et al.&nbsp;2009)</li>
</ul></li>
</ul>
<p>Looking at the shrinkage:</p>
<div class="cell">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="co"># show shrinkage</span></span>
<span id="cb7-2"><a></a>DT<span class="sc">::</span><span class="fu">datatable</span>(true_fit<span class="sc">$</span>shrink <span class="sc">%&gt;%</span> <span class="fu">mutate_all</span>(round,<span class="dv">2</span>), <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-76ce7440ff2c395ce089" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-76ce7440ff2c395ce089">{"x":{"filter":"none","vertical":false,"data":[["mean","var","sd","skewness","kurtosis","var shrinkage (%)","sd shrinkage (%)","t statistic","p-value"],[0.01,0.11,0.33,-0.27,0.86,33.29,18.33,0.26,0.8],[0.02,0.05,0.23,-0.32,1.2,58.04,35.23,0.8,0.43],[-0.01,0.35,0.59,0.6899999999999999,3.11,65.09,40.92,-0.14,0.89],[-0,0.08,0.29,-0.04,-0.4,-0.42,-0.21,-0.09,0.93],[0.01,0.97,0.99,0.5,0.41,2.56,1.29,0.74,1.54]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>eta.Vmax<\/th>\n      <th>eta.Km<\/th>\n      <th>eta.CL<\/th>\n      <th>eta.V1<\/th>\n      <th>IWRES<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"eta.Vmax","targets":1},{"name":"eta.Km","targets":2},{"name":"eta.CL","targets":3},{"name":"eta.V1","targets":4},{"name":"IWRES","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="other-diagnostic-plots-eta-correlations" class="slide level2 smaller">
<h2>2.6 Other Diagnostic Plots: Eta Correlations</h2>
<ul>
<li>Exploring the correlation between Etas is important for understanding the relationships between random effects.
<ul>
<li>Helps inform the need for additional covariates or model refinements (omega block).</li>
</ul></li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="co"># Plot Eta correlations</span></span>
<span id="cb8-2"><a></a>true_fit <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a></a>  <span class="fu">select</span>(ID,eta.Km, eta.CL, eta.V1) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a></a>  pmplots<span class="sc">::</span><span class="fu">eta_pairs</span>( <span class="at">etas =</span> <span class="fu">c</span>(<span class="st">"eta.Km"</span>,<span class="st">"eta.CL"</span>, <span class="st">"eta.V1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-11-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="other-diagnostic-plots-individual-plots" class="slide level2 smaller">
<h2>2.7 Other Diagnostic Plots: Individual Plots</h2>
<ul>
<li>Individual plots can help identify outliers or trends in individual data points that may not be apparent in population-level plots.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="co"># Generate individual plots</span></span>
<span id="cb9-2"><a></a></span>
<span id="cb9-3"><a></a>plot_ind_misspecified <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a></a>  <span class="fu">filter</span>(MDV <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(TIME, DV)) <span class="sc">+</span> </span>
<span id="cb9-6"><a></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb9-7"><a></a>  <span class="co">#geom_line(aes(group = ID)) + </span></span>
<span id="cb9-8"><a></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> misspecified_fit ,<span class="fu">aes</span>(<span class="at">x=</span> TIME, <span class="at">y=</span> IPRED, <span class="at">group=</span>ID), <span class="at">color =</span> <span class="st">"#167fc9"</span>, <span class="at">alpha=</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> misspecified_fit,<span class="fu">aes</span>(<span class="at">x=</span> TIME, <span class="at">y=</span> PRED, <span class="at">group=</span>ID), <span class="at">color =</span> <span class="st">"#167fc9"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha=</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb9-10"><a></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(EVID <span class="sc">==</span><span class="dv">1</span> ), <span class="fu">aes</span>(<span class="at">xintercept =</span> TIME), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb9-11"><a></a>  <span class="co">#ggrepel::geom_label_repel(data=misspecified_fit %&gt;% </span></span>
<span id="cb9-12"><a></a>  <span class="co">#                            filter(abs(CWRES)&gt;=3) %&gt;% </span></span>
<span id="cb9-13"><a></a>  <span class="co">#                            mutate(ID = as.numeric(as.character(ID))),</span></span>
<span id="cb9-14"><a></a>  <span class="co">#                aes(label = round(abs(CWRES),2)),</span></span>
<span id="cb9-15"><a></a>  <span class="co">#               box.padding   = 0.35,</span></span>
<span id="cb9-16"><a></a>  <span class="co">#               point.padding = 0.8,</span></span>
<span id="cb9-17"><a></a>  <span class="co">#               segment.color = 'grey50') +</span></span>
<span id="cb9-18"><a></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Misspecified Model"</span>) <span class="sc">+</span> </span>
<span id="cb9-19"><a></a>  ggforce<span class="sc">::</span><span class="fu">facet_wrap_paginate</span>(<span class="sc">~</span>ID, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb9-20"><a></a></span>
<span id="cb9-21"><a></a>  npages <span class="ot">=</span> ggforce<span class="sc">::</span><span class="fu">n_pages</span>(plot_ind_misspecified)</span>
<span id="cb9-22"><a></a>  </span>
<span id="cb9-23"><a></a></span>
<span id="cb9-24"><a></a>plot_ind_true <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb9-25"><a></a>  <span class="fu">filter</span>(MDV <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-26"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(TIME, DV)) <span class="sc">+</span> </span>
<span id="cb9-27"><a></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span> ) <span class="sc">+</span></span>
<span id="cb9-28"><a></a>  <span class="co">#geom_line(aes(group = ID)) + </span></span>
<span id="cb9-29"><a></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> true_fit ,<span class="fu">aes</span>(<span class="at">x=</span> TIME, <span class="at">y=</span> IPRED, <span class="at">group=</span>ID), <span class="at">color =</span> <span class="st">"#167fc9"</span>, <span class="at">alpha=</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb9-30"><a></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> true_fit,<span class="fu">aes</span>(<span class="at">x=</span> TIME, <span class="at">y=</span> PRED, <span class="at">group=</span>ID), <span class="at">color =</span> <span class="st">"#167fc9"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha=</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb9-31"><a></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(EVID <span class="sc">==</span><span class="dv">1</span> ), <span class="fu">aes</span>(<span class="at">xintercept =</span> TIME), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb9-32"><a></a>  <span class="co">#ggrepel::geom_label_repel(data=true_fit %&gt;% </span></span>
<span id="cb9-33"><a></a>  <span class="co">#                            filter(abs(CWRES)&gt;=3) %&gt;% </span></span>
<span id="cb9-34"><a></a>  <span class="co">#                            mutate(ID = as.numeric(as.character(ID))),</span></span>
<span id="cb9-35"><a></a>  <span class="co">#                aes(label = round(abs(CWRES),2)),</span></span>
<span id="cb9-36"><a></a>  <span class="co">#               box.padding   = 0.35,</span></span>
<span id="cb9-37"><a></a>  <span class="co">#               point.padding = 0.8,</span></span>
<span id="cb9-38"><a></a>  <span class="co">#               segment.color = 'grey50') +</span></span>
<span id="cb9-39"><a></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"True Model"</span>) <span class="sc">+</span> </span>
<span id="cb9-40"><a></a>  ggforce<span class="sc">::</span><span class="fu">facet_wrap_paginate</span>(<span class="sc">~</span>ID, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb9-41"><a></a></span>
<span id="cb9-42"><a></a>  npages <span class="ot">=</span> ggforce<span class="sc">::</span><span class="fu">n_pages</span>(plot_ind_true)  </span>
<span id="cb9-43"><a></a>  </span>
<span id="cb9-44"><a></a></span>
<span id="cb9-45"><a></a></span>
<span id="cb9-46"><a></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(plot_ind_misspecified <span class="sc">+</span> <span class="fu">facet_wrap_paginate</span>(<span class="sc">~</span>ID,<span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">page =</span> <span class="dv">1</span>), </span>
<span id="cb9-47"><a></a>                  plot_ind_true <span class="sc">+</span> <span class="fu">facet_wrap_paginate</span>(<span class="sc">~</span>ID,<span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">page =</span> <span class="dv">1</span>), </span>
<span id="cb9-48"><a></a>                  <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-12-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1152"></section></section>
<section>
<section id="introduction-to-visual-predictive-checks-vpcs" class="title-slide slide level1 center">
<h1>Introduction to Visual Predictive Checks (VPCs)</h1>

</section>
<section id="definition-and-purpose" class="slide level2">
<h2>3.1 Definition and Purpose</h2>
<p>VPCs offer a powerful way to compare observed data percentiles to simulated data percentiles​</p>
<ul>
<li><p>Advantages: VPCs account for variability and help visualize prediction intervals​</p>
<ul>
<li><p>Discrepancies between observed percentiles and predicted intervals highlight potential misspecifications in structural or residual models</p></li>
<li><p>Prediction-corrected VPCs (pcVPCs) are another common version of VPCs that adjust for study design variability (e.g., different dosing regimens or covariates)​</p></li>
</ul></li>
</ul>
</section>
<section id="mathematical-foundations-of-pcvpcs" class="slide level2 scrollable smaller">
<h2>3.2 Mathematical Foundations of pcVPCs</h2>
<p>In <strong>Prediction-Corrected Visual Predictive Checks (pcVPCs)</strong>, the observed and simulated concentrations are adjusted to account for variability due to study design (e.g., different dosing regimens or covariates). This correction is based on the ratio of the <strong>median model-predicted concentration</strong> for a typical individual in a specific time bin to the <strong>individual-specific predicted concentration</strong> for each observation.</p>
<p>The <strong>prediction-corrected concentration</strong> <span class="math inline">\(C_{\text{pc},i,j}\)</span> for individual <span class="math inline">\(i\)</span> at time point <span class="math inline">\(j\)</span> is calculated as:</p>
<p><span class="math display">\[
C_{\text{pc},i,j} = C_{i,j} \times \frac{PRED_{\text{median}, j_{\text{bin}}}}{PRED_{i,j}}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(C_{i,j}\)</span> = Observed or simulated concentration for individual <span class="math inline">\(i\)</span> at time point <span class="math inline">\(j\)</span>.</li>
<li><span class="math inline">\(PRED_{\text{median}, j_{\text{bin}}}\)</span> = <strong>Median model-predicted concentration</strong> for a typical individual in time bin <span class="math inline">\(j_{\text{bin}}\)</span>, using typical parameter values (e.g., population-level parameters).</li>
<li><span class="math inline">\(PRED_{i,j}\)</span> = <strong>Individual-specific model-predicted concentration</strong> for individual <span class="math inline">\(i\)</span> at time point <span class="math inline">\(j\)</span>, taking into account individual covariates and random effects.</li>
</ul>
<p><strong>Purpose of the Correction:</strong></p>
<p>By using the median predicted concentration for each time bin <span class="math inline">\(j_{\text{bin}}\)</span>, this approach normalizes observed and simulated data relative to a typical individual. This ensures that variability in dosing, covariates, or sampling schedules across individuals is appropriately corrected, making it easier to detect model misspecifications without the confounding effects of study design variability.</p>
</section>
<section id="conducting-vpcs" class="slide level2 scrollable smaller">
<h2>3.3 Conducting VPCs</h2>
<p>Interpretation: Does the observed data distribution fall within the predicted intervals and confidence bands. Look for systematic trends that could indicate residual error misspecification​</p>
<ul>
<li>This won’t tell us anything about the model’s <strong>predictive</strong> performance at the individual level.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="co"># Perform pcVPC</span></span>
<span id="cb10-2"><a></a>misspecified_vpc <span class="ot">&lt;-</span> nlmixr2<span class="sc">::</span><span class="fu">vpcSim</span>(misspecified_fit,<span class="at">n =</span> <span class="dv">500</span>, <span class="at">pred=</span>T)</span>
<span id="cb10-3"><a></a>true_vpc <span class="ot">&lt;-</span> nlmixr2<span class="sc">::</span><span class="fu">vpcSim</span>(true_fit,<span class="at">n =</span> <span class="dv">500</span>, <span class="at">pred=</span>T, <span class="at">keep =</span> <span class="st">"DOSE"</span>)</span>
<span id="cb10-4"><a></a></span>
<span id="cb10-5"><a></a></span>
<span id="cb10-6"><a></a>misspecified_vpc_time <span class="ot">&lt;-</span> misspecified_fit <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ID))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-8"><a></a>  <span class="fu">left_join</span>(</span>
<span id="cb10-9"><a></a>    misspecified_vpc <span class="sc">%&gt;%</span> </span>
<span id="cb10-10"><a></a>      <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(id))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-11"><a></a>      <span class="fu">select</span>(ID, <span class="at">TIME=</span>time, pred) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb10-12"><a></a>    ) <span class="sc">%&gt;%</span>  </span>
<span id="cb10-13"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">observed</span>(<span class="at">x =</span> TIME, <span class="at">y =</span> DV) <span class="sc">%&gt;%</span></span>
<span id="cb10-14"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">simulated</span>(misspecified_vpc, <span class="at">y =</span> ipred) <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">binning</span>(<span class="at">bin =</span> <span class="st">"jenks"</span>, <span class="at">n_bins =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span>  <span class="co"># You can adjust the number of bins</span></span>
<span id="cb10-16"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">predcorrect</span>(<span class="at">pred=</span>pred) <span class="sc">%&gt;%</span> </span>
<span id="cb10-17"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">vpcstats</span>()</span>
<span id="cb10-18"><a></a></span>
<span id="cb10-19"><a></a></span>
<span id="cb10-20"><a></a>misspecified_vpc_tad <span class="ot">&lt;-</span> misspecified_fit <span class="sc">%&gt;%</span></span>
<span id="cb10-21"><a></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ID))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-22"><a></a>  <span class="fu">left_join</span>(</span>
<span id="cb10-23"><a></a>    misspecified_vpc <span class="sc">%&gt;%</span> </span>
<span id="cb10-24"><a></a>      <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(id))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-25"><a></a>      <span class="fu">select</span>(ID, <span class="at">TIME=</span>time, pred) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb10-26"><a></a>    ) <span class="sc">%&gt;%</span>  </span>
<span id="cb10-27"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">observed</span>(<span class="at">x =</span> tad, <span class="at">y =</span> DV) <span class="sc">%&gt;%</span></span>
<span id="cb10-28"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">simulated</span>(misspecified_vpc, <span class="at">y =</span> ipred) <span class="sc">%&gt;%</span></span>
<span id="cb10-29"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">binning</span>(<span class="at">bin =</span> <span class="st">"jenks"</span>, <span class="at">n_bins =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span>  <span class="co"># You can adjust the number of bins</span></span>
<span id="cb10-30"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">predcorrect</span>(<span class="at">pred=</span>pred) <span class="sc">%&gt;%</span> </span>
<span id="cb10-31"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">vpcstats</span>()</span>
<span id="cb10-32"><a></a></span>
<span id="cb10-33"><a></a>true_vpc_time <span class="ot">&lt;-</span> true_fit <span class="sc">%&gt;%</span> </span>
<span id="cb10-34"><a></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ID))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-35"><a></a>  <span class="fu">left_join</span>(</span>
<span id="cb10-36"><a></a>    true_vpc <span class="sc">%&gt;%</span> </span>
<span id="cb10-37"><a></a>      <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(id))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-38"><a></a>      <span class="fu">select</span>(ID, <span class="at">TIME=</span>time, pred) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb10-39"><a></a>    ) <span class="sc">%&gt;%</span>  </span>
<span id="cb10-40"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">observed</span>(<span class="at">x =</span> TIME, <span class="at">y =</span> DV) <span class="sc">%&gt;%</span></span>
<span id="cb10-41"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">simulated</span>(true_vpc, <span class="at">y =</span> ipred) <span class="sc">%&gt;%</span></span>
<span id="cb10-42"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">binning</span>(<span class="at">bin =</span> <span class="st">"jenks"</span>, <span class="at">n_bins =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span>  <span class="co"># You can adjust the number of bins</span></span>
<span id="cb10-43"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">predcorrect</span>(<span class="at">pred=</span>pred) <span class="sc">%&gt;%</span> </span>
<span id="cb10-44"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">vpcstats</span>()</span>
<span id="cb10-45"><a></a></span>
<span id="cb10-46"><a></a>true_vpc_tad <span class="ot">&lt;-</span> true_fit <span class="sc">%&gt;%</span> </span>
<span id="cb10-47"><a></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ID))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-48"><a></a>  <span class="fu">left_join</span>(</span>
<span id="cb10-49"><a></a>    true_vpc <span class="sc">%&gt;%</span> </span>
<span id="cb10-50"><a></a>      <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(id))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-51"><a></a>      <span class="fu">select</span>(ID, <span class="at">TIME=</span>time, pred) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb10-52"><a></a>    ) <span class="sc">%&gt;%</span>  </span>
<span id="cb10-53"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">observed</span>(<span class="at">x =</span> tad, <span class="at">y =</span> DV) <span class="sc">%&gt;%</span></span>
<span id="cb10-54"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">simulated</span>(true_vpc, <span class="at">y =</span> ipred) <span class="sc">%&gt;%</span></span>
<span id="cb10-55"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">binning</span>(<span class="at">bin =</span> <span class="st">"jenks"</span>, <span class="at">n_bins =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span>  <span class="co"># You can adjust the number of bins</span></span>
<span id="cb10-56"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">predcorrect</span>(<span class="at">pred=</span>pred) <span class="sc">%&gt;%</span> </span>
<span id="cb10-57"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">vpcstats</span>()</span>
<span id="cb10-58"><a></a></span>
<span id="cb10-59"><a></a></span>
<span id="cb10-60"><a></a>a <span class="ot">&lt;-</span> <span class="fu">plot</span>(misspecified_vpc_time) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Misspecified Model"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Time (hrs)"</span>)</span>
<span id="cb10-61"><a></a>b <span class="ot">&lt;-</span> <span class="fu">plot</span>(misspecified_vpc_tad) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Time After Dose (hrs)"</span>) </span>
<span id="cb10-62"><a></a>c <span class="ot">&lt;-</span> <span class="fu">plot</span>(true_vpc_time) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"True Model"</span>) <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">"Time (hrs)"</span>)</span>
<span id="cb10-63"><a></a>d <span class="ot">&lt;-</span> <span class="fu">plot</span>(true_vpc_tad) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Time After Dose (hrs)"</span>) </span>
<span id="cb10-64"><a></a></span>
<span id="cb10-65"><a></a></span>
<span id="cb10-66"><a></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(a, c, b, d, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<img data-src="index_files/figure-revealjs/unnamed-chunk-16-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1152"></section>
<section id="stratified-vpcs" class="slide level2 scrollable smaller">
<h2>3.4 Stratified VPCs</h2>
<p>Important to consider relevant stratification to fully evaluate model performance​</p>
<div class="cell">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>true_vpc_strata <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a></a>  <span class="fu">filter</span>(MDV <span class="sc">==</span> <span class="dv">0</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ID))) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a></a>  <span class="fu">left_join</span>(</span>
<span id="cb11-5"><a></a>    true_vpc <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a></a>      <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(id))) <span class="sc">%&gt;%</span> </span>
<span id="cb11-7"><a></a>      <span class="fu">select</span>(ID, <span class="at">TIME=</span>time, pred) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb11-8"><a></a>    ) <span class="sc">%&gt;%</span>  </span>
<span id="cb11-9"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">observed</span>(<span class="at">x =</span> TIME, <span class="at">y =</span> DV) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">simulated</span>(true_vpc, <span class="at">y =</span> sim) <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">stratify</span>(<span class="sc">~</span>DOSE) <span class="sc">%&gt;%</span> </span>
<span id="cb11-12"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">binning</span>(<span class="at">bin =</span> <span class="st">"jenks"</span>, <span class="at">n_bins =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span>  <span class="co"># You can adjust the number of bins</span></span>
<span id="cb11-13"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">predcorrect</span>(<span class="at">pred=</span>pred) <span class="sc">%&gt;%</span> </span>
<span id="cb11-14"><a></a>  tidyvpc<span class="sc">::</span><span class="fu">vpcstats</span>()</span>
<span id="cb11-15"><a></a></span>
<span id="cb11-16"><a></a><span class="fu">plot</span>(true_vpc_strata) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"True Model ~ Stratified by dose"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Time (hrs)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<img data-src="index_files/figure-revealjs/unnamed-chunk-18-1.png" width="960" class="r-stretch"></section>
<section id="other-vpc-flavors-psn" class="slide level2 smaller">
<h2>3.5 Other VPC Flavors: PSN</h2>
<p>Pearl-Speaks-Nonmem (PSN) is another popular tool for VPCs, offering a range of features and customization options​</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a></a><span class="co"># Example PSN command</span></span>
<span id="cb12-2"><a></a><span class="ex">vpc</span> run1.mod <span class="at">-samples</span><span class="op">=</span>500 <span class="at">-auto_bin</span><span class="op">=</span>10 <span class="at">-rplots</span><span class="op">=</span>1 <span class="at">-output_dir</span><span class="op">=</span>vpc_dir1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="co"># Example code visualizing VPCs generated using PSN</span></span>
<span id="cb13-2"><a></a><span class="fu">library</span>(xpose)</span>
<span id="cb13-3"><a></a></span>
<span id="cb13-4"><a></a><span class="co"># Load PSN VPC data</span></span>
<span id="cb13-5"><a></a>xpdb <span class="ot">&lt;-</span> <span class="fu">xpose_data</span>(<span class="at">dir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"nonmem"</span>),<span class="at">prefix =</span> <span class="st">"Run"</span>, <span class="dv">1</span>) </span>
<span id="cb13-6"><a></a></span>
<span id="cb13-7"><a></a></span>
<span id="cb13-8"><a></a>xpdb <span class="sc">%&gt;%</span> </span>
<span id="cb13-9"><a></a> <span class="fu">vpc_data</span>(<span class="at">psn_folder =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"nonmem"</span>, <span class="st">"vpc_dir1"</span>)) <span class="sc">%&gt;%</span>  <span class="co"># Compute the vpc data</span></span>
<span id="cb13-10"><a></a> <span class="fu">vpc</span>()            <span class="co"># Plot the vpc</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<img data-src="images/vpc_xpose.png" class="r-stretch quarto-figure-center"><p class="caption">PSN VPC Example</p></section>
<section id="other-vpc-flavors-mrgsolve-tidyvpc" class="slide level2 smaller">
<h2>3.6 Other VPC Flavors: MRGsolve + TidyVPC</h2>
<p>There are also options to perform your nonmem simulations outside of nonmem using tools like mrgsolve.</p>
<div class="cell">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a><span class="co"># Example code for running VPCs using mrgsolve and tidyvpc</span></span>
<span id="cb14-2"><a></a><span class="co"># Sim for VPC</span></span>
<span id="cb14-3"><a></a>n.vpc <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb14-4"><a></a></span>
<span id="cb14-5"><a></a>df.sim.vpc <span class="ot">&lt;-</span></span>
<span id="cb14-6"><a></a>  df.nm <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a></a>  <span class="co"># Add parameter values</span></span>
<span id="cb14-8"><a></a>  <span class="fu">expand_grid</span>(df.theta) <span class="sc">%&gt;%</span> </span>
<span id="cb14-9"><a></a>  <span class="co"># Duplicate all records n.vpc times</span></span>
<span id="cb14-10"><a></a>  <span class="co"># Need to give different ID#</span></span>
<span id="cb14-11"><a></a>  <span class="fu">expand_grid</span>(<span class="at">REP =</span> <span class="dv">1</span><span class="sc">:</span>n.vpc) <span class="sc">%&gt;%</span> </span>
<span id="cb14-12"><a></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> NMID <span class="sc">*</span> n.vpc <span class="sc">+</span> REP) <span class="sc">%&gt;%</span> </span>
<span id="cb14-13"><a></a>  <span class="fu">arrange</span>(REP, NMID, TIME, EVID)</span>
<span id="cb14-14"><a></a></span>
<span id="cb14-15"><a></a>mrgsim.vpc <span class="ot">&lt;-</span> </span>
<span id="cb14-16"><a></a>  mod_pk <span class="sc">%&gt;%</span> </span>
<span id="cb14-17"><a></a>  <span class="fu">carry_out</span>(REP, NMID, AMT, EVID, WT, SEX) <span class="sc">%&gt;%</span> </span>
<span id="cb14-18"><a></a>  <span class="fu">data_set</span>(df.sim.vpc) <span class="sc">%&gt;%</span></span>
<span id="cb14-19"><a></a>  <span class="fu">omat</span>(d.omat) <span class="sc">%&gt;%</span> </span>
<span id="cb14-20"><a></a>  <span class="fu">mrgsim</span>(<span class="at">tad =</span> <span class="cn">TRUE</span>, <span class="at">recover =</span> <span class="st">"PHASE"</span>)</span>
<span id="cb14-21"><a></a></span>
<span id="cb14-22"><a></a>df.mrgsim.vpc <span class="ot">&lt;-</span> </span>
<span id="cb14-23"><a></a>  <span class="fu">as_tibble</span>(mrgsim.vpc) <span class="sc">%&gt;%</span> </span>
<span id="cb14-24"><a></a>  <span class="fu">filter</span>(EVID <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb14-25"><a></a></span>
<span id="cb14-26"><a></a></span>
<span id="cb14-27"><a></a><span class="co"># Sim PRED (required for tidyvpc)</span></span>
<span id="cb14-28"><a></a>df.sim.pred.for.vpc <span class="ot">&lt;-</span></span>
<span id="cb14-29"><a></a>  df.nm <span class="sc">%&gt;%</span> </span>
<span id="cb14-30"><a></a>  <span class="co"># Add parameter values</span></span>
<span id="cb14-31"><a></a>  <span class="fu">expand_grid</span>(df.theta) <span class="sc">%&gt;%</span> </span>
<span id="cb14-32"><a></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> NMID) </span>
<span id="cb14-33"><a></a></span>
<span id="cb14-34"><a></a>mrgsim.pred.for.vpc <span class="ot">&lt;-</span> </span>
<span id="cb14-35"><a></a>  mod_pk <span class="sc">%&gt;%</span> </span>
<span id="cb14-36"><a></a>  <span class="fu">carry_out</span>(NMID, AMT, EVID) <span class="sc">%&gt;%</span> </span>
<span id="cb14-37"><a></a>  <span class="fu">data_set</span>(df.sim.pred.for.vpc) <span class="sc">%&gt;%</span></span>
<span id="cb14-38"><a></a>  <span class="fu">zero_re</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-39"><a></a>  <span class="fu">mrgsim</span>(<span class="at">tad =</span> <span class="cn">TRUE</span>, <span class="at">recover =</span> <span class="st">"PHASE"</span>)</span>
<span id="cb14-40"><a></a></span>
<span id="cb14-41"><a></a>df.tad.pred <span class="ot">&lt;-</span> </span>
<span id="cb14-42"><a></a>  mrgsim.pred.for.vpc <span class="sc">%&gt;%</span> </span>
<span id="cb14-43"><a></a>  <span class="fu">filter</span>(EVID <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-44"><a></a>  <span class="co"># Here IPRED is PRED as zero_re was used</span></span>
<span id="cb14-45"><a></a>  <span class="fu">select</span>(tad, <span class="at">PRED =</span> IPRED)</span>
<span id="cb14-46"><a></a></span>
<span id="cb14-47"><a></a></span>
<span id="cb14-48"><a></a>vpc <span class="ot">&lt;-</span> </span>
<span id="cb14-49"><a></a>  df.nm.obs <span class="sc">%&gt;%</span> </span>
<span id="cb14-50"><a></a>  <span class="fu">bind_cols</span>(df.tad.pred) <span class="sc">%&gt;%</span> </span>
<span id="cb14-51"><a></a>  <span class="fu">mutate</span>(<span class="at">PHASE =</span> <span class="fu">factor</span>(PHASE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"SD"</span>, <span class="st">"MD"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb14-52"><a></a>  <span class="fu">observed</span>(<span class="at">x=</span>TIME, <span class="at">y=</span>DV) <span class="sc">%&gt;%</span></span>
<span id="cb14-53"><a></a>  <span class="fu">simulated</span>(df.mrgsim.vpc, <span class="at">y=</span>DV) <span class="sc">%&gt;%</span></span>
<span id="cb14-54"><a></a>  <span class="fu">stratify</span>(<span class="sc">~</span>PHASE) <span class="sc">%&gt;%</span> </span>
<span id="cb14-55"><a></a>  <span class="co"># binning(bin = NTIM) %&gt;% </span></span>
<span id="cb14-56"><a></a>  <span class="fu">binning</span>(<span class="at">bin =</span> <span class="st">"breaks"</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">12</span>, <span class="dv">24</span>, <span class="dv">171</span>, <span class="dv">185</span>, <span class="dv">200</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-57"><a></a>  <span class="fu">vpcstats</span>()</span>
<span id="cb14-58"><a></a></span>
<span id="cb14-59"><a></a><span class="fu">plot</span>(vpc) <span class="sc">+</span></span>
<span id="cb14-60"><a></a>  <span class="fu">xgx_scale_x_time_units</span>(<span class="at">units_dataset =</span> time_units_dataset, </span>
<span id="cb14-61"><a></a>                         <span class="at">units_plot    =</span> time_units_plot,</span>
<span id="cb14-62"><a></a>                         <span class="at">breaks =</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">40</span>) <span class="sc">*</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<img data-src="images/vpc.png" class="r-stretch quarto-figure-center"><p class="caption">MRGsolve + TidyVPC Example</p></section></section>
<section>
<section id="common-pitfalls-and-best-practices" class="title-slide slide level1 center">
<h1>Common Pitfalls and Best Practices</h1>

</section>
<section id="over-interpretation-of-diagnostics" class="slide level2">
<h2>4.1 Over-Interpretation of Diagnostics</h2>
<ul>
<li><p><strong>Critical</strong> Remember to evaluate your model with respect to your clinical context and use case.</p></li>
<li><p>Avoid over-interpreting random variability as model issues, especially in sparse data settings​</p></li>
<li><p>Need to interpret GOF plots with caution in high shrinkage situations (situation where VPCs maybe more useful)​</p></li>
</ul>
</section></section>
<section>
<section id="conclusion-and-summary" class="title-slide slide level1 center">
<h1>Conclusion and Summary</h1>

</section>
<section id="recap-of-key-points" class="slide level2 smaller">
<h2>6.1 Recap of Key Points</h2>
<p>GOF and VPC are critical tools in model evaluation, helping to identify structural and residual errors they should be performed throughout the model development process at critical steps.</p>

<img data-src="images/poppk_workflow.png" class="r-stretch"></section>
<section id="final-thoughts" class="slide level2">
<h2>6.2 Final Thoughts</h2>
<p>Iterative Process: Model building is an iterative process. Be prepared to refine the model based on diagnostic outputs​</p>
</section></section>
<section>
<section id="references" class="title-slide slide level1 smaller center">
<h1>References</h1>
<ul>
<li><p><a href="https://pubmed.ncbi.nlm.nih.gov/27884052/">Nguyen et al.: Model Evaluation of Continuous Data Pharmacometric Models: Metrics and Graphics, CPT Pharmacometrics Syst. Pharmacol. 2017.</a></p></li>
<li><p><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC3085712/">Bergstrand, Martin et al.&nbsp;“Prediction-corrected visual predictive checks for diagnosing nonlinear mixed-effects models.” The AAPS journal vol.&nbsp;13,2 (2011): 143-51. doi:10.1208/s12248-011-9255-z</a></p></li>
<li><p><a href="https://www.fda.gov/media/71364/download">FDA Guidelines: Population Pharmacokinetics Guidance.</a></p></li>
<li><p><a href="https://merge.metrumrg.com/expo/expo1-nonmem-foce/posts/pk-vpc-final.html">Metrum VPC Examples</a></p></li>
<li><p><a href="https://certara.github.io/tidyvpc/index.html">Tidy VPC</a></p></li>
<li><p><a href="https://metrumresearchgroup.github.io/pmplots/">PMPlots</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/xpose/index.html">Xpose</a></p></li>
</ul>
</section>
<section class="slide level2">


<div class="quarto-auto-generated-content">
<p><img src="images/quarto.png" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'zoom',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>